<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ í´ë¼ìš°ë“œ ë¶ë§ˆí¬ (ì§„ë‹¨ëª¨ë“œ)</title>
    <style>
        :root { --bg-color: #f4f4f9; --container-bg: #ffffff; --primary-color: #333; --accent-color: #007bff; --border-color: #ddd; }
        body { font-family: 'Segoe UI', AppleSDGothicNeo, sans-serif; background-color: var(--bg-color); margin: 0; padding: 20px; color: var(--primary-color); }
        .container { max-width: 800px; margin: 0 auto; background-color: var(--container-bg); padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        h2 { margin: 0; font-size: 1.2rem; color: #555; }
        
        .add-btn { background-color: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 4px; font-weight: bold; cursor: pointer; text-decoration: none; font-size: 14px; }

        #searchBox { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid var(--border-color); border-radius: 4px; box-sizing: border-box; font-size: 16px; background: #fafafa; }
        
        ul { list-style: none; padding: 0; margin: 0; border-top: 1px solid var(--border-color); }
        li { padding: 10px 10px; border-bottom: 1px solid #eee; }
        a.main-link { text-decoration: none; color: #333; font-weight: 600; display: block; font-size: 15px; }
        .url-preview { font-size: 12px; color: #999; display: block; margin-top: 2px; }

        /* ì§„ë‹¨ìš© ìŠ¤íƒ€ì¼ */
        .debug-box { margin-top: 30px; padding: 15px; background: #333; color: #0f0; font-family: monospace; font-size: 12px; border-radius: 5px; overflow-x: auto; white-space: pre-wrap; }
        .debug-title { color: #fff; border-bottom: 1px solid #555; padding-bottom: 5px; margin-bottom: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h2>â˜ï¸ ë‚´ ë¶ë§ˆí¬ (ì§„ë‹¨ì¤‘)</h2>
        <a id="formLink" href="#" target="_blank" class="add-btn">+ ì¶”ê°€í•˜ê¸°</a>
    </header>
    
    <input type="text" id="searchBox" placeholder="ğŸ” ê²€ìƒ‰..." onkeyup="filterLinks()">

    <ul id="linkList">
        <li style="text-align:center; padding:20px;">ë°ì´í„° ì—°ê²° ì‹œë„ ì¤‘...</li>
    </ul>

    <div class="debug-box">
        <div class="debug-title">ğŸ› ï¸ ë°ì´í„° ìˆ˜ì‹  ìƒíƒœì°½ (ì—¬ê¸°ë¥¼ ì½ì–´ë³´ì„¸ìš”)</div>
        <div id="debugLog">ëŒ€ê¸° ì¤‘...</div>
    </div>
</div>

<script>
    // â–¼â–¼â–¼ ì—¬ê¸°ì— CSV ì£¼ì†Œë¥¼ ë‹¤ì‹œ ë„£ì–´ì£¼ì„¸ìš” â–¼â–¼â–¼
    const SHEET_CSV_URL = "ì—¬ê¸°ì—_CSV_ì£¼ì†Œ_ë¶™ì—¬ë„£ê¸°"; 
    const GOOGLE_FORM_URL = "ì—¬ê¸°ì—_ì„¤ë¬¸ì§€_ì£¼ì†Œ";


    document.getElementById('formLink').href = GOOGLE_FORM_URL;
    document.addEventListener('DOMContentLoaded', loadData);

    async function loadData() {
        const list = document.getElementById('linkList');
        const debugLog = document.getElementById('debugLog');
        
        try {
            // ìºì‹œ ë°©ì§€ìš© ë‚œìˆ˜ ì¶”ê°€
            const response = await fetch(SHEET_CSV_URL + '&t=' + new Date().getTime());
            const data = await response.text();
            
            // 1. í™”ë©´ ì•„ë˜ ê²€ì€ ë°•ìŠ¤ì— ì›ë³¸ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ì°ì–´ë´…ë‹ˆë‹¤.
            debugLog.innerText = "ë°ì´í„° ê¸¸ì´: " + data.length + "ê¸€ì\n\n[ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°]:\n" + data.substring(0, 500) + "...";

            // 2. ë§Œì•½ HTML ì½”ë“œê°€ ë³´ì´ë©´ ì—ëŸ¬ í‘œì‹œ
            if(data.includes('<html') || data.includes('function(')) {
                list.innerHTML = `<li style="color:red; text-align:center;">âŒ ì£¼ì†Œ ì˜¤ë¥˜!<br>HTML í˜•ì‹ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.<br>CSV ë§í¬ê°€ ë§ëŠ”ì§€ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.</li>`;
                return;
            }

            const rows = data.split('\n');
            list.innerHTML = ''; 

            if(rows.length < 2) {
                list.innerHTML = `<li style="padding:20px; text-align:center;">ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. (ì„¤ë¬¸ì§€ ì‘ë‹µì´ ì—†ê±°ë‚˜, ì‹œíŠ¸ê°€ ë¹„ì–´ìˆìŒ)</li>`;
            }

            // 3. ë°ì´í„°ë¥¼ í•œ ì¤„ì”© ì½ì–´ì„œ ëª©ë¡ì„ ë§Œë“­ë‹ˆë‹¤. (ì¡°ê±´ì„ ì•„ì£¼ ëŠìŠ¨í•˜ê²Œ í’€ì—ˆìŠµë‹ˆë‹¤)
            let count = 0;
            // ìµœì‹ ìˆœ ì •ë ¬ì„ ìœ„í•´ ë’¤ì§‘ê¸°
            const reversedRows = [...rows].reverse();

            reversedRows.forEach(row => {
                // ì½¤ë§ˆë¡œ ë‚˜ëˆ„ê¸°
                const cols = row.split(',');
                
                // ë°ì´í„°ê°€ ë„ˆë¬´ ì§§ìœ¼ë©´ ë¬´ì‹œ (ë¹ˆ ì¤„)
                if(row.length < 5) return;

                // [ì¤‘ìš”] ì»¬ëŸ¼ ìœ„ì¹˜ ì°¾ê¸° (ë¬´ì¡°ê±´ ë§¨ ë’¤ì— ìˆëŠ” ê²Œ ì£¼ì†Œë¼ê³  ê°€ì •)
                // ë³´í†µ: [íƒ€ì„ìŠ¤íƒ¬í”„, ì´ë¦„, ì£¼ì†Œ] ìˆœì„œì„.
                
                // ì´ë¦„: ì½¤ë§ˆë¡œ ë‚˜ëˆ´ì„ ë•Œ 2ë²ˆì§¸ ì¹¸ (ì¸ë±ìŠ¤ 1)
                let name = (cols[1] || "ì´ë¦„ ì—†ìŒ").replace(/^"|"$/g, '').trim();
                
                // ì£¼ì†Œ: ì½¤ë§ˆë¡œ ë‚˜ëˆ´ì„ ë•Œ 3ë²ˆì§¸ ì¹¸ (ì¸ë±ìŠ¤ 2), ì—†ìœ¼ë©´ ë§¨ ë§ˆì§€ë§‰ ì¹¸ ì‚¬ìš©
                let url = (cols[2] || cols[cols.length-1] || "").replace(/^"|"$/g, '').trim();

                // í—¤ë”(ì œëª©ì¤„) ì œì™¸í•˜ê¸°
                if(name.includes("Web_Site_Name") || url.includes("Wev_adress")) return;

                // URLì— http ì—†ìœ¼ë©´ ë¶™ì´ê¸°
                if(url && !url.startsWith('http')) url = 'https://' + url;

                // ëª©ë¡ ì¶”ê°€
                const li = document.createElement('li');
                li.innerHTML = `
                    <a href="${url}" class="main-link" target="_blank">
                        ${name}
                        <span class="url-preview">${url}</span>
                    </a>
                `;
                list.appendChild(li);
                count++;
            });

            if(count === 0) {
                 list.innerHTML = `<li style="padding:20px; text-align:center;">ëª©ë¡ì„ ë§Œë“¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>ì•„ë˜ ê²€ì€ ë°•ìŠ¤ì˜ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</li>`;
            }

        } catch (error) {
            list.innerHTML = `<li style="color:red; text-align:center;">ì—°ê²° ì‹¤íŒ¨! ì¸í„°ë„· ìƒíƒœë‚˜ ì£¼ì†Œë¥¼ í™•ì¸í•˜ì„¸ìš”.</li>`;
            debugLog.innerText = "ì—ëŸ¬ ë°œìƒ: " + error;
        }
    }

    function filterLinks() {
        const query = document.getElementById('searchBox').value.toLowerCase();
        const items = document.querySelectorAll('#linkList li');
        items.forEach(item => {
            const text = item.innerText.toLowerCase();
            item.style.display = text.includes(query) ? 'block' : 'none';
        });
    }
</script>

</body>
</html>
